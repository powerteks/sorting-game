export default class{constructor(t,e,i){this.store=t,this.model=e,this.view=i,this.store.cache=!1,this.pause=!1,this.preventNum=null,this.animation=!1,this.initControl()}initControl(){this.store.bottles.forEach(e=>{e.addEventListener("click",t=>this.handleBottle(e))}),this.store.buttons.forEach(e=>{e.addEventListener("click",t=>this.handleButton(e))}),this.store.blockWin.addEventListener("click",t=>this.handleBlockWin())}handleBottle(t){t=t.dataset.num;this.model.hasFullBottle(t)?this.view.animationErrorBottle(t):this.pause||(this.store.cache?this.sendToBottle(t):this.model.hasEmptyBottle(t)||this.sendToCache(t))}handleButton(t){"Reset"===t.textContent&&(this.model.reset(),setTimeout(()=>this.view.reRender([],!0),1e3)),"Undo"===t.textContent&&0<this.store.history.length&&(this.model.moveBack(),this.view.reRender([],!0)),"Restart"===t.textContent&&(this.model.restart(),this.view.reRender([],!0)),"Skin"===t.textContent&&(t=this.store.skin+1<this.store.skins?this.store.skin+1:0,this.changeSkin(t),this.view.reRender([],!0))}handleBlockWin(){this.model.reset(),this.view.reRender([],!0),this.view.hideScreenWin()}sendToCache(t){this.pause=!0,this.store.cache=!0,this.previousNum=t,this.moveCells=this.model.moveToCache(t),this.view.animationToCash(t,this.moveCells),setTimeout(()=>{this.pause=!1},this.store.timeAnimation*(this.moveCells.length+1))}sendToBottle(t){this.pause=!0,this.store.cache=!1;const{bottle:e,cells:i,fullBottle:s,win:o}=this.model.moveToBottle(t,this.previousNum);this.previousNum===e?(this.view.returnToBottle(e,i),this.view.animationErrorBottle(t)):this.view.animationToBottle(this.previousNum,e,this.moveCells,i);let h=i.length+1;s&&(setTimeout(()=>{this.view.animationFullBottle(e)},this.store.timeAnimation*h),h++),setTimeout(()=>{o?(this.pause=!0,this.view.showScreenWin(),setTimeout(()=>this.pause=!1,200)):(this.view.reRender([this.previousNum,e]),this.previousNum=null,this.pause=!1)},this.store.timeAnimation*h*2)}changeSkin(t){var e=this.store.skin;this.view.applySkin(e,t),this.store.skin=t,localStorage.setItem("skin",t)}}